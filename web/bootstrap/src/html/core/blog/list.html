<!DOCTYPE html>
<html lang="zh-CN">
<head>
    @@include('../../layout/header.html', {
        "title"     : "Betterlife Front UI",
        "rel-prefix": "../.."
    })
</head>
<body>
    <!-- main nav begin -->
    @@include('../../layout/navbar.html', {
        "rel-prefix": "../.."
    })
    <!-- main nav end -->

    <!-- page container begin -->
    <div class="page-container">

        <!-- page content begin -->
        <div class="page-content">
            <!-- main sidebar begin -->
            @@include('../../layout/sidebar.html', {
                "rel-prefix": "../.."
            })
            <!-- main sidebar end -->

            <!-- main content begin -->
            <div class="content-wrapper">
                <!-- page header begin -->
                <div class="row">
                  <div class="breadcrumb-line">
                    <ul class="breadcrumb">
                      <li><a href="/"><i class="icon-home2 position-left"></i> 首页</a></li>
                      <li class="active">读书</li>
                    </ul>
                  </div>
                </div>
                <!-- page header end -->

                <!-- content area begin -->
                <div class="container-fluid list">
                    <div class="row up-container">
                        <!-- 上半部分 -->
                        <div class="filter-up">
                            <div class="filter-up-right col-sm-12">
                                <div>
                                    <i aria-label="search-menu" class="glyphicon glyphicon-search" aria-hidden="true"></i>
                                    <input id="input-search" type="search" placeholder="搜索名称" aria-controls="infoTable" />
                                    <button id="btn-query" type="button" class="btn btn-query">搜索</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row table-responsive col-xs-12">
                        <table id="infoTable" class="display nowrap dataTable table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>名称</th>
                                    <th>编码</th>
                                    <th>联系人</th>
                                    <th>手机号</th>
                                    <th>封面</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>


                <!--footer begin-->
                @@include('../../layout/footer.html',{
                  "rel-prefix": "../.."
                })
                <!--footer end-->

                <!-- content area end -->
            </div>
            <!-- main content end -->
        </div>
        <!-- page container end -->
    </div>

    <!-- template begin -->
    <div id="image-model"></div>
    <script id="imgModalTmpl" type="text/x-jsrender">
    <!-- Creates the bootstrap modal where the image will appear -->
    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">X</span></button>
          </div>
          <div class="modal-body">
            <a id="imagePreview-link" href="#" target="_blank"><img src="" id="imagePreview" style="width: 100%; height: 100%;" ></a>
          </div>
        </div>
      </div>
    </div>
    </script>
    <script id="imgTmpl" type="text/x-jsrender">
    <a id="{{:img_id}}" href="#"><img src="{{:img_src}}" alt="{{:img_name}}" /></a>
    </script>
    <script id="actionTmpl" type="text/x-jsrender">
    <a id="info-view{{:id}}" href="#" class="view" data-toggle="modal" data-target="#infoModal">查看</a>&nbsp;
    <a id="info-edit{{:id}}" href="#" class="edit" data-toggle="modal" data-target="#infoModal">修改</a>&nbsp;
    <a id="info-dele{{:id}}" href="#" class="dele" data-toggle="modal" data-target="#infoModal">删除</a>
    </script>
    <!-- template end -->

    <script src="../../js/normal/list.js"></script>

    <script type="text/javascript">
    $(function(){
        $("#image-model").html($.templates("#imgModalTmpl"));

        //Datatables中文网[帮助]: http://datatables.club/
        var infoTable = $('#infoTable').DataTable({
            "language"  : $.dataTable.chinese, 
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url" : "../../data/list.json",
                // "type": "GET",
                // "contentType": "application/json",
                "data": function ( d ) {
                    d.query = $("#input-search").val();
                    return d;
                    // return JSON.stringify( d );
                },
                //可以对返回的结果进行改写
                "dataFilter": function(data){
                    // return data;
                    var json = jQuery.parseJSON( data );
                    var p = infoTable.ajax.params();
                    json.draw = p.draw;
                    var info = infoTable.page.info();
                    var length= info.length;
                    var page = p.start / length + 1;
                    if (page == 1) {
                      json.data = json.data.slice(0, p.length);
                    } else {
                      json.data = json.data.slice(p.length);
                    }
                    return JSON.stringify( json ); // return JSON string
                }
            },
            "responsive"   : true,
            "searching"    : false,
            "ordering"     : false,
            "dom"          : '<"top">rt<"bottom"lp><"clear">',
            "bLengthChange": true,
            "aLengthMenu"  : [[10, 25, 50, 100,-1],[10, 25, 50, 100,'全部']],
            "columns": [
                { data:"id" },
                { data:"name" },
                { data:"code" },
                { data:"contactName" },
                { data:"phone" },
                { data:"imgUrl" },
                { data:"status"},
                { data:"id" }
            ],
            "columnDefs": [
                {"orderable":false,"targets":5,
                    "render" : function(data, type, row) {
                        // var result = '<a id="imgUrl'+row.id+'" href="#"><img src="'+data+'" alt="'+row.imgName+'" /></a>';
                        var data     = {
                            "img_id"  : "imgUrl"+row.id,
                            "img_src" : data,
                            "img_name": row.imgName
                        };
                        var result = $.templates("#imgTmpl").render(data);

                        $("body").off('click', 'a#imgUrl'+row.id);
                        $("body").on('click', 'a#imgUrl'+row.id, function(){
                            $('#imagePreview').attr('src', $('a#imgUrl' + row.id + " img").attr('src'));
                            $('#imagePreview-link').attr('href', $('a#imgUrl' + row.id + " img").attr('src'));
                            $('#imageModal').modal('show');
                        });
                        return result;
                    }
                },
                {"orderable":false, "targets":6,
                    "render" : function(data,type,row){
                        if (data==0){
                            return '<span class="status-fail">审核失败</span>';
                        }else if ( data == 1 )
                            return '<span class="status-pass">审核通过</span>';
                        else{
                            return '<span class="status-wait">待审核</span>';
                        }
                    }
                },
                {"orderable":false, "targets":7,
                    "render" : function(data, type, row){
                        // var result = '<a href="#" id ="info-view'+data+'" class="view" data-toggle="modal" data-target="#infoModal">查看</a>&nbsp;<a href="#" id ="info-edit'+data+'" class="edit" data-toggle="modal" data-target="#infoModal">修改</a>&nbsp;<a id="info-del'+data+'" data-toggle="modal" data-target="#infoModal" href="#" class="del">删除</a>';
                        var result = $.templates("#actionTmpl").render({ "id"  : data });

                        $("body").off('click', 'a#info-view'+data);
                        $("body").on('click', 'a#info-view'+data, function(){//查看
                            bootbox.confirm("确定要查看该用户:" + data + "?",function(result){
                                if ( result == true ){
                                    console.log("查看用户:" + data);
                                }
                            });
                        });
                        $("body").off('click', 'a#info-edit'+data);
                        $("body").on('click', 'a#info-edit'+data, function(){//修改
                            bootbox.confirm("确定要编辑该用户:" + data + "?",function(result){
                                if ( result == true ){
                                    console.log("编辑用户:" + data);
                                }
                            });
                        });
                        $("body").off('click', 'a#info-dele'+data);
                        $("body").on('click', 'a#info-dele'+data, function(){//删除
                            bootbox.confirm("确定要删除该用户:" + data + "?",function(result){
                                if ( result == true ){
                                    console.log("删除用户:" + data);
                                }
                            });
                        });
                        return result;
                    }
                }
            ],
            // "aoColumns"    : [
            //     null,
            //     { "sType": "chinese-string" },//中文排序列
            //     { "sType": "chinese-string" },
            //     null,
            //     null,
            //     null,
            //     null
            // ],
            "initComplete":function(){ },
            "drawCallback": function( settings ) {
                $.dataTable.pageNumDisplay(this);
            }
        });
        $("#btn-query").click(function(){infoTable.draw();});
    });
    </script>

</body>
</html>
